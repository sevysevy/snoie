{% extends "base.html" %}
{% load i18n static %}
{% load widget_tweaks %}
{% get_media_prefix  as MEDIA_URL %}

{% block title %} 
    SNOIE | {% translate "Mission" %}
{% endblock %}


{% block content %}

<section class="content-header row">
    <div class="col-sm-12">
        <h1>Détails de la mission</h1>
        {% csrf_token %}
    </div>

    
   
</section>
<hr>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">

                {% if request.user.user_profile.organisation.organisation_type.name != ""Lobbying"" %}
                    <span class="">
                        <input type="button" value="Ajouter un document" class="btn btn-warning btn-sm add-doc">
                    </span>
                {% endif %}

                <div class="dropdown float-right">
                    <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                    Options
                    </button>
                    <div class="dropdown-menu dropdown-menu-right">
                        {% if request.user.user_profile.organisation.organisation_type.name != ""Lobbying"" %}
                        
                            <a class="dropdown-item add-doc" href="#">Ajouter un document</a>
                        {% endif %}

                        <a class="dropdown-item {% if mission.statut_mission == "pending" %} edit-mode {% else %} disabled {% endif %}" href="#">Modifier la mission</a>

                        <a class="dropdown-item {% if mission.statut_mission == "pending" %} delete {% else %} disabled {% endif %}" href="#">Supprimer</a>
                    </div>
                </div>

            </div>
        </div>

        <hr>
        <div class="row">
            <div class="col-12">
                <div class="card card-success mt-3">
                    <div class="card-header">
                        <h3 class="card-title">
                            {{mission.name}}

                            
                        </h3>
                        {% if mission.statut_mission == 'pending' %}
                                <span class="float-right badge bg-secondary">
                                    En attente
                                </span>
                            {% elif mission.statut_mission == 'running' %}
                                <span class="float-right badge bg-primary">
                                    En cours
                                </span>
                            {% elif mission.statut_mission == 'ended' %}
                                <span class="float-right badge bg-success">
                                    Terminé
                                </span>

                            {% elif fiche.state == 'canceled' %}
                                <span class="float-right badge bg-danger">
                                    Non réalisée
                                </span>
                            {% endif %}
                    </div>
        
                    <div class="card-body">
                        <ul class="list_details_mission">
                            <li>
                                <a href="{% url 'view-update-fi' mission.fiche_information.id %}" rel="noopener noreferrer" style = "padding-right : 20px" target="_blank">
                                  Fiche d'information  
                                  
                               </a>

                                <span class="date_ajout_document">Ajouté le {{mission.fiche_information.created_at | date:'d/m/Y'}} </span>

                            </li>

                            <li>
                                <a href="{% url 'view-update-fp' mission.fiche_pertinence.id %}" rel="noopener noreferrer" style = "padding-right : 20px" target="_blank">
                                  Fiche de pertinence  
                                  
                               </a>

                               <span class="date_ajout_document">Ajouté le {{mission.fiche_pertinence.created_at | date:'d/m/Y'}} </span>

                            </li> 
                            {% if mission.draft_tdr  %}
                            <!-- draft TDR -->

                                <li>
                                    <a href="{% url  'download-mission-doc' mission.id %}?doc-type=draft-tdr" rel="noopener noreferrer" style = "padding-right : 20px">   Premier draft de Termes de reference</a>
                                    
                                    <span class="date_ajout_document">Ajouté le  {{mission.date_draft_tdr | date:'d/m/Y'}}</span>
                                </li>
                            {% endif %}



                            {% if mission.tdr_amender  %}
                          
                            <!-- tdr amender -->
                                    <li>
                                        
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=tdr-amender" rel="noopener noreferrer" style = "padding-right : 20px" >
                                            Termes de references amendés </a>
                                        
                                     
                                        <span class="date_ajout_document">Ajouté le {{mission.date_tdr_amender | date:'d/m/Y'}} </span>
                                        
                                    </li>
                            {% endif %}

                            {% if mission.tdr_valid  %}
                                
                                    <li>
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=tdr-valid" rel="noopener noreferrer" style = "padding-right : 20px" target="_blank">
                                        Termes de references validé
                                        
                                        </a>

                                        <span class="date_ajout_document">Ajouté le {{mission.date_tdr_valid | date:'d/m/Y'}}</span>
                                        
                                    </li>

                            {% endif %}

                            {% if mission.ordre_mission  %}
                                    
                                    <li>

                                        
                                            <a href="{% url  'download-mission-doc' mission.id %}?doc-type=ordre-mission" rel="noopener noreferrer" style = "padding-right : 20px" >
                                            Ordre de mission </a>
                                        
                                            <span class="date_ajout_document">Ajouté le  {{mission.date_ordre_mission | date:'d/m/Y'}}</span>
                                     

                                    </li>

                            {% endif %}

                            {% if mission.pv_entretient  %}
                                

                                    <li>
                                        
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=pv-entretien" rel="noopener noreferrer" style = "padding-right : 20px">
                                            PV d'entretien   
                                        </a>
                                        
                                        <span class="date_ajout_document">Ajouté le {{mission.date_pv_entretien | date:'d/m/Y'}} </span>
                                        
                                    </li>

                            {% endif %}


                            {% if mission.compte_rendu_entretient  %}

                                    <li>
                                        
                                            <a href="{% url  'download-mission-doc' mission.id %}?doc-type=compte-rd-entretien" rel="noopener noreferrer" style = "padding-right : 20px" >
                                            Compte rendu d'entretien </a>
                                        
                                        
                                            <span class="date_ajout_document"> Ajouté le {{mission.date_compte_rendu_entretien | date:'d/m/Y'}} </span>
                                        

                                    </li>

                            {% endif %}

                            {% if mission.fiche_observation  %}
                               

                                    <li>

                                            <a href="{% url  'download-mission-doc' mission.id %}?doc-type=fiche-observation" rel="noopener noreferrer" style = "padding-right : 20px" >
                                            Fiche d'observation</a>
                                        

                                            <span class="date_ajout_document">Ajouté le  {{mission.date_fiche_observation | date:'d/m/Y'}}</span>
                                        
                                    </li>

                            {% endif %}


                            {% if mission.check_list_conformite %}
             
                                    <li>
                                            <a href="{% url  'download-mission-doc' mission.id %}?doc-type=check-list-conform" rel="noopener noreferrer" style = "padding-right : 20px"  >
                                            Check list de conformité </a>
                                        

                                            <span class="date_ajout_document">Ajouté le  {{mission.date_check_list | date:'d/m/Y'}}</span>
                                    </li>
                            {% endif %}
                            
                            {% if mission.rapport_mission %}
                               
                                    <li>
                                        
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=rapport-mission" rel="noopener noreferrer" style = "padding-right : 20px" > Premier draft de rapport de mission  </a>
                                       
                                            <span class="date_ajout_document">Ajouté le  {{mission.date_rapport_mission | date:'d/m/Y'}}</span>
                                        
                                    </li>  
                            {% endif %}  

                            {% if mission.rapport_mission_commente %}
                               
                                    <li>
                                        
                                            <a href="{% url  'download-mission-doc' mission.id %}?doc-type=rapport-mission-commente" rel="noopener noreferrer" style = "padding-right : 20px" >
                                            Rapport de mission commenté</a>
                                        
                                            
                                            <span class="date_ajout_document">Ajouté le  {{mission.date_mission_commente | date:'d/m/Y'}}</span>
                                        
                                    </li>

                            {% endif %}

                            {% if mission.rapport_mission_amende_1 %}

                                    <li>
                                        
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=rapport-mission-amender-1" rel="noopener noreferrer" style = "padding-right : 20px" >
                                        Rapport de mission amendé 1 </a>
                                    
                                        <span class="date_ajout_document">Ajouté le {{mission.date_mission_amende_1 | date:'d/m/Y'}}</span>
                                        
                                    </li>

                            {% endif %}


                            {% if mission.rapport_mission_amende_2 %}
                                
                                    <li>
                                        
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=rapport-mission-amender-2" rel="noopener noreferrer" style = "padding-right : 20px" > Rapport de mission amendé 2 </a>
                                       

                                        <span class="date_ajout_document">Ajouté le  {{mission.date_mission_amende_2 | date:'d/m/Y'}}</span>
                                     
                                    </li>

                            {% endif %}


                            {% if mission.rapport_mission_approuve %}
                                
                                    <li>
                                        <a href="{% url  'download-mission-doc' mission.id %}?doc-type=rapport-mission-approuver" rel="noopener noreferrer" style = "padding-right : 20px" > Rapport de mission approuvé</a>
                                    
                                        <span class="date_ajout_document">Ajouté le  {{mission.date_mission_approuve | date:'d/m/Y'}}</span>
                                   
                                    </li>
                            {% endif %}

                            

                        </ul>

                        {% if mission.statut_mission == "cancelled" %}
                            <br><br>
                            <h4> Mission annulée par :  </h4>
                            <br>
                            <h5>Motif de la non réalisation de la mission : </h4>
                            <textarea class="form-control" readonly = "readonly" > </textarea>
                            <br><br>

                            <h4>Commentaires sur la non réalisation de la mission : </h4>
                            <textarea class="form-control" readonly = "readonly" > </textarea>
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>
        
        
    </div>
</section>



<div class="modal fade" id="addModal" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ajouter un document </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="{% url 'add-mission-doc' mission.id %}" method="POST" enctype="multipart/form-data">{% csrf_token %}
                    
                  
                    <div class="form-group" id="select-fp">
                        <label for="fp" id="fp-label">Sélectionnez le type de document</label>

                        <select name="doc-type" id="doc-type" class="form-control" required="">
                            <option value="tdr-amender">TDR Amendé</option>
                            <option value="tdr-valid">TDR Validé</option>
                            <option value="ordre-mission">Ordre de Mission</option>
                            <option value="pv-entretien">PV d'Entretien </option>
                            <option value="compte-rd-entretien">Compte Rendu d'Entretien</option>
                            <option value="fiche-observation">Fiche d'Observation</option>
                            <option value="check-list-conform">Check List Conformite</option>
                            <option value="rapport-mission">Rapport de Mission</option>
                            <option value="rapport-mission-commente">Rapport de Mission commenté</option>
                            <option value="rapport-mission-amender-1">Rapport de Mission Amendé 1</option>
                            <option value="rapport-mission-amender-2">Rapport de Mission Amendé 2</option>
                            <option value="rapport-mission-approuver">Rapport de Mission Approuvé</option>
                            
                                
                        </select>
                        
                    </div>
                    
                    <div class="form-group">
                        <label>Joindre le fichier </label>
                        <div class="input-group">
                            <input type="file" name="document" class="form-control">
                        </div>
                    </div>
                    
                   
                    <div class="form-group">
                        <input type="submit" value="Valider" class="form-control btn btn-success" style="margin-bottom: 10px">
                        <br>
                        <input type="button" value="Annuler" class="btn btn-warning form-control" data-dismiss="modal">
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
</div>


<script>

$(document).ready(function () {


$(".add-doc").on("click" , function(e){
    e.preventDefault()

    $("#addModal").modal('show')
})



});



</script>


{% endblock %}